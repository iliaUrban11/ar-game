<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Catch Game - 3 –®–∫–∞–ª—ã</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; overflow: hidden; }
    
    /* –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω */
    #welcome { 
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      display: flex; flex-direction: column; justify-content: center; align-items: center; 
      color: white; text-align: center; z-index: 1000; 
    }
    #welcome h1 { font-size: 2.5em; margin: 0 0 20px; }
    #welcome p { font-size: 1.2em; max-width: 80%; margin: 0 0 30px; }
    #startBtn { padding: 15px 30px; font-size: 1.5em; background: #ff6b6b; color: white; border: none; border-radius: 50px; cursor: pointer; transition: transform 0.2s; }
    #startBtn:hover { transform: scale(1.05); }
    
    /* –ò–≥—Ä–æ–≤–æ–π UI (–æ–≤–µ—Ä–ª–µ–π) */
    #ui { position: fixed; top: 20px; left: 20px; right: 20px; z-index: 999; color: white; pointer-events: none; }
    #timer { font-size: 2em; text-align: center; margin-bottom: 10px; }
    .scale { margin: 10px 0; background: rgba(255,255,255,0.2); border-radius: 10px; height: 20px; overflow: hidden; }
    .scale-fill { height: 100%; transition: width 0.3s; border-radius: 10px; }
    #red { background: #ff4757; }
    #green { background: #2ed573; }
    #blue { background: #3742fa; }
    #results { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; z-index: 1001; }
    #results h2 { font-size: 3em; margin: 0 0 20px; }
    #restartBtn { padding: 15px 30px; font-size: 1.2em; background: #00b894; color: white; border: none; border-radius: 50px; cursor: pointer; }
    
    /* –°–∫—Ä—ã—Ç–∏–µ A-Frame –Ω–∞ —Å—Ç–∞—Ä—Ç–µ */
    #arScene { display: none; }
  </style>
</head>
<body>
  <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω -->
  <div id="welcome">
    <h1>üéÆ AR –õ–æ–≤–∏ –®–∫–∞–ª—ã!</h1>
    <p>–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä. –õ–æ–≤–∏—Ç–µ –ª–µ—Ç–∞—é—â–∏–µ —Å—Ñ–µ—Ä—ã –∫–∞—Å–∞–Ω–∏–µ–º!<br>–ö—Ä–∞—Å–Ω—ã–µ ‚Üí –∫—Ä–∞—Å–Ω–∞—è —à–∫–∞–ª–∞ | –ó–µ–ª—ë–Ω—ã–µ ‚Üí –∑–µ–ª—ë–Ω–∞—è | –°–∏–Ω–∏–µ ‚Üí —Å–∏–Ω—è—è<br>30 —Å–µ–∫—É–Ω–¥ ‚Äî –º–∞–∫—Å–∏–º—É–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è!</p>
    <button id="startBtn">üöÄ –°–¢–ê–†–¢</button>
  </div>

  <!-- –ò–≥—Ä–æ–≤–æ–π UI -->
  <div id="ui">
    <div id="timer">30</div>
    <div>–ö—Ä–∞—Å–Ω—ã–µ: <div class="scale"><div id="red-fill" class="scale-fill" style="width:0%"></div></div></div>
    <div>–ó–µ–ª—ë–Ω—ã–µ: <div class="scale"><div id="green-fill" class="scale-fill" style="width:0%"></div></div></div>
    <div>–°–∏–Ω–∏–µ: <div class="scale"><div id="blue-fill" class="scale-fill" style="width:0%"></div></div></div>
  </div>

  <!-- –≠–∫—Ä–∞–Ω –∏—Ç–æ–≥–æ–≤ -->
  <div id="results">
    <h2 id="finalScore">–ò–¢–û–ì–ò</h2>
    <p id="finalDetails"></p>
    <button id="restartBtn">–ò–ì–†–ê–¢–¨ –ó–ê–ù–û–í–û</button>
  </div>

  <!-- AR –°—Ü–µ–Ω–∞ -->
  <a-scene id="arScene" embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-marker preset="hiro">
      <a-entity id="gameArea"></a-entity>
    </a-marker>
    <a-entity camera look-controls="enabled: false"></a-entity>
  </a-scene>

  <script>
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
    let gameActive = false;
    let timeLeft = 30;
    let scores = { red: 0, green: 0, blue: 0 };
    let timerInterval;
    let spawnInterval;
    const maxScore = 20; // –ü–æ–ª–Ω–∞—è —à–∫–∞–ª–∞ –Ω–∞ 20 –ª–æ–≤–ª—è—Ö

    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const welcome = document.getElementById('welcome');
    const arScene = document.getElementById('arScene');
    const ui = document.getElementById('ui');
    const timerEl = document.getElementById('timer');
    const fills = {
      red: document.getElementById('red-fill'),
      green: document.getElementById('green-fill'),
      blue: document.getElementById('blue-fill')
    };
    const results = document.getElementById('results');
    const finalScoreEl = document.getElementById('finalScore');
    const finalDetailsEl = document.getElementById('finalDetails');

    // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
    document.getElementById('startBtn').addEventListener('click', startGame);
    document.getElementById('restartBtn').addEventListener('click', restartGame);

    function startGame() {
      welcome.style.display = 'none';
      arScene.style.display = 'block';
      ui.style.pointerEvents = 'none';
      gameActive = true;
      timeLeft = 30;
      scores = { red: 0, green: 0, blue: 0 };
      updateUI();

      // –¢–∞–π–º–µ—Ä
      timerInterval = setInterval(() => {
        timeLeft--;
        timerEl.textContent = timeLeft;
        updateUI();
        if (timeLeft <= 0) endGame();
      }, 1000);

      // –°–ø–∞–≤–Ω –æ–±—ä–µ–∫—Ç–æ–≤
      spawnInterval = setInterval(spawnObject, 800 + Math.random() * 800);
    }

    function spawnObject() {
      if (!gameActive) return;

      const colors = ['red', 'green', 'blue'];
      const color = colors[Math.floor(Math.random() * 3)];
      const obj = document.createElement('a-sphere');
      obj.setAttribute('radius', '0.08');
      obj.setAttribute('color', color === 'red' ? '#ff4757' : color === 'green' ? '#2ed573' : '#3742fa');
      obj.setAttribute('position', `${(Math.random() - 0.5) * 4} ${1 + Math.random() * 2} ${(Math.random() - 0.5) * 4}`);
      obj.setAttribute('data-color', color);

      // –•–∞–æ—Ç–∏—á–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª—ë—Ç–∞
      const endPos = `${(Math.random() - 0.5) * 4} ${Math.random() * 1 - 0.5} ${(Math.random() - 0.5) * 4}`;
      obj.setAttribute('animation', `property: position; to: ${endPos}; dur: ${3000 + Math.random() * 2000}; loop: false; easing: easeInOutSine`);
      obj.setAttribute('animation__rotate', 'property: rotation; to: 0 360 0; dur: 4000; loop: true; easing: linear');

      // –ö–ª–∏–∫-–ª–æ–≤–ª—è
      obj.addEventListener('click', () => {
        if (gameActive) {
          scores[color]++;
          obj.remove();
          updateUI();
        }
      });

      document.getElementById('gameArea').appendChild(obj);

      // –°–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ
      setTimeout(() => obj.remove(), 6000);
    }

    function updateUI() {
      Object.keys(scores).forEach(c => {
        const percent = Math.min((scores[c] / maxScore) * 100, 100);
        fills[c].style.width = percent + '%';
      });
    }

    function endGame() {
      gameActive = false;
      clearInterval(timerInterval);
      clearInterval(spawnInterval);

      // –û—á–∏—Å—Ç–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤
      document.querySelectorAll('a-sphere').forEach(obj => obj.remove());

      // –ò—Ç–æ–≥–∏
      const total = scores.red + scores.green + scores.blue;
      finalScoreEl.textContent = `–û—á–∫–∏: ${total}`;
      finalDetailsEl.innerHTML = `
        –ö—Ä–∞—Å–Ω—ã–µ: ${scores.red}/${maxScore}<br>
        –ó–µ–ª—ë–Ω—ã–µ: ${scores.green}/${maxScore}<br>
        –°–∏–Ω–∏–µ: ${scores.blue}/${maxScore}
      `;
      results.style.display = 'flex';
    }

    function restartGame() {
      results.style.display = 'none';
      startGame();
    }
  </script>
</body>
</html>
